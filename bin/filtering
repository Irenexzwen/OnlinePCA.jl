using OnlinePCA
using ArgParse:
    ArgParseSettings, parse_args, @add_arg_table

# options
function parse_commandline()
    s = ArgParseSettings()

    @add_arg_table s begin
        "--slfile", "-s"
            help = "input file (serialized)"
            arg_type = AbstractString
            required = true
        "--featurelist", "-g"
            help = "Feature list for filtering"
            arg_type = AbstractString
            required = true
        "--thr", "-t"
            help = "Threshold for filtering"
            arg_type = AbstractString
            required = true
        "--outdir", "-o"
            help = "output directory"
            arg_type = AbstractString
            default = "."
            required = false
    end

    return parse_args(s)
end

# main
function main()
    parsed_args = parse_commandline()
    println("Parsed args:")
    for (arg,val) in parsed_args
        println("  $arg  =>  $val")
    end

    thr = parse(Float32, parsed_args["thr"])

    OnlinePCA.filtering(slfile=parsed_args["slfile"], featurelist=parsed_args["featurelist"], thr=thr, outdir=parsed_args["outdir"])
end

main()