using OnlinePCA
using ArgParse:
    ArgParseSettings, parse_args, @add_arg_table

# main
function main()
    parsed_args = common_parse_commandline()
    println("Parsed args:")
    for (arg,val) in parsed_args
        println("  $arg  =>  $val")
    end

    out = rsvrg(input=parsed_args["input"],
        logscale=parsed_args["logscale"],
        pseudocount=parsed_args["pseudocount"],
        rowmeanlist=parsed_args["rowmeanlist"],
        colsumlist=parsed_args["colsumlist"],
        masklist=parsed_args["masklist"],
        dim=parsed_args["dim"],
        stepsize=parsed_args["stepsize"],
        numepoch=parsed_args["numepoch"],
        scheduling=parsed_args["scheduling"],
        g=parsed_args["g"],
        epsilon=parsed_args["epsilon"],
        logdir=parsed_args["logdir"])

    writecsv(parsed_args["outdir"]*"/Eigen_vectors.csv", out[1])
    writecsv(parsed_args["outdir"]*"/Eigen_values.csv", out[2])
    writecsv(parsed_args["outdir"]*"/Loadings.csv", out[3])
    writecsv(parsed_args["outdir"]*"/Scores.csv", out[4])

    touch(parsed_args["outdir"]*"/Eigen_vectors.csv")
    touch(parsed_args["outdir"]*"/Eigen_values.csv")
    touch(parsed_args["outdir"]*"/Loadings.csv")
    touch(parsed_args["outdir"]*"/Scores.csv")
end

main()